(function(){if(typeof jsMVC==="undefined"){jsMVC={_Controller:[],_Form:[],isLog:true,version:"1.1.0"};jsMVC.$Controller=function(b,a){this[b]=a};jsMVC.Event=function(){this._listeners=[]};jsMVC.Event.prototype={attach:function(a){this._listeners.push(a)},notify:function(c){for(var a=0,b=this._listeners.length;a<b;a++){this._listeners[a](c)}}};jsMVC.Form=function(){_Form:[]};jsMVC.Form.prototype={getElementValue:function(a){if(typeof a=="object"){return a.value}},setElementValue:function(a,b){if(typeof a=="object"){a.value=b}},saveForm:function(a){jsMVC._Form.push(a)},loadForm:function(c){var b=jsMVC._Form;for(var a=0;a<b.length;a++){if(b[a]==c){return document[b[a]]}}}};jsMVC.setController=function(b,a){if(typeof jsMVC._Controller[b]=="undefined"){jsMVC._Controller[b]=new a()}else{jsMVC.Error("[registController] duplicated Controller's instance name : "+b)}};jsMVC.setModel=function(c,b,a){if(typeof jsMVC._Controller[c]!="undefined"){jsMVC.getController(c).$jsMVC(b,new a())}else{jsMVC.Error("[registModel] '"+c+"' not found")}};jsMVC.getModel=function(b,a){if(typeof jsMVC._Controller[b]!="undefined"){if(typeof jsMVC.getController(b)[a]!="undefined"){return jsMVC.getController(b)[a]}else{jsMVC.Error("[getModel] '"+b+"' not found : "+a)}}else{jsMVC.Error("[getModel] '"+b+"'  not found : "+a)}};jsMVC.setView=function(c,b,a){if(typeof jsMVC._Controller[c]!="undefined"){jsMVC.getController(c).$jsMVC(b,new a())}else{jsMVC.Error("[registView] '"+c+"' not found")}};jsMVC.getView=function(b,a){if(typeof jsMVC._Controller[b]!="undefined"){if(typeof jsMVC.getController(b)[a]!="undefined"){return jsMVC.getController(b)[a]}else{jsMVC.Error("[getView] '"+b+"'  not found : "+a)}}else{jsMVC.Error("[getView] '"+b+"'  not found : "+a)}};jsMVC.setForm=function(d,b,a){if(typeof jsMVC._Controller[d]!="undefined"){for(var c in jsMVC.Form.prototype){a.prototype[c]=jsMVC.Form.prototype[c]}jsMVC.getController(d).$jsMVC(b,new a())}else{jsMVC.Error("[registForm] '"+d+"' not found")}};jsMVC.getForm=function(b,a){if(typeof jsMVC._Controller[b]!="undefined"){if(typeof jsMVC.getController(b)[a]!="undefined"){return jsMVC.getController(b)[a]}else{jsMVC.Error("[getForm] '"+b+"'  not found : "+a)}}else{jsMVC.Error("[getForm] '"+b+"'  not found : "+a)}};jsMVC.getController=function(a){if(typeof jsMVC._Controller[a]!="undefined"){return jsMVC._Controller[a]}else{jsMVC.Error("[getController] '"+a+"' not found")}};jsMVC.Error=function(a){throw new Error(a)};jsMVC.Log=function(a){if(jsMVC.isLog==true){if(typeof console=="object"){console.log(a)}}}}})();BriefWidgetController=$Class({$jsMVC:jsMVC.$Controller,CLOSEVISIBLEBUDDY:"비공개 하시겠습니까?",DELETEBUDDY:"/connect/FollowerVisibilityClose.nhn",_sBuddyTemplage:"",start:function(a){this._oModel=jsMVC.getModel("briefWidgetController","briefWidgetModel");this._oModel.initMembers(a);this._welTabArea=$Element("briefTab");this._setEvent();this._oModel.evInit.notify()},_setEvent:function(){$Fn(this._onClick,this).attach($("briefWidget"),"click")},_onClick:function(b){var c=b.element;var a=$Element(cssquery.getSingle("!a",c)?cssquery.getSingle("!a",c):c);var d=this._getParam(a.className());if(a.hasClass("_prev")){if(this._oModel.getPageNo()>1){this._pageCountDown();this._listContent(this._getAsyncListURL(this._oModel.getPageNo()),$Fn(this._onLoadListInfo,this).bind())}}else{if(a.hasClass("_next")){if(this._oModel.getPageNo()<this._oModel.getTotalPageCount()){this._pageCountUp();this._listContent(this._getAsyncListURL(this._oModel.getPageNo()),$Fn(this._onLoadListInfo,this).bind())}}else{if(a.hasClass("_tab1")){this._onTab1Clicked(a)}else{if(a.hasClass("_tab2")){this._onTab2Clicked(a)}else{if(a.hasClass("_deleteBuddy")){this._onDeleteBuddyClicked()}}}}}if(a.hasClass("_clickcr")){clickcr(a.$value(),d[0],"",d[1]||"",b.$value())}if(a.hasClass("_returnFalse")){b.stop()}},_onDeleteBuddyClicked:function(){if(confirm(this.CLOSEVISIBLEBUDDY)){var a=$("deleteBuddyForm");a.action=this._oModel.getSectionDomain()+BuddyConnect.METADATA.URL.DELETEBUDDY+"?blogId="+this._oModel.getBlogId();a.blogNo.value=this._oModel.getBlogUserNo();a.buddyBlogNo.value=this._oModel.getBlogNo();a.widgetSeq.value=this._oModel.getWidgetSeq();a.submit()}},_onTab1Clicked:function(a){if(this._oModel.isViewTab1()){return}this._oModel.setViewTab1();this._oModel.evTabChanged.notify();this._loadFirstPage()},_onTab2Clicked:function(a){if(this._oModel.isViewTab2()){return}this._oModel.setViewTab2();this._oModel.evTabChanged.notify();this._loadFirstPage()},_loadFirstPage:function(){this._oModel.setFirstPageNo();this._loadPage(this._oModel.getPageNo())},_loadPage:function(a){this._listContent(this._getAsyncListURL(a),$Fn(this._onLoadListInfo,this).bind())},_pageCountUp:function(){this._oModel.setPageNo(this._oModel.getPageNo()+1)},_pageCountDown:function(){this._oModel.setPageNo(this._oModel.getPageNo()-1)},_listContent:function(a,b){var c=new $Ajax(a,{onload:$Fn(function(f){var g=f.json();if(g.isSuccess){var d=g.result;if(this._oModel.isViewTab1()){this._oModel.setBuddyCount(d.buddyCount)}else{this._oModel.setFollowerCount(d.buddyCount)}var e=d.buddies;this._oModel.setBuddyListInfo(e);if(e.totalCount%e.countPerPage!=0){this._oModel.setTotalPageCount(Math.floor(e.totalCount/e.countPerPage)+1)}else{this._oModel.setTotalPageCount(e.totalCount/e.countPerPage)}this._oModel.setTotalCountForPaging(e.totalCount);if(b&&typeof b=="function"){b()}}},this).bind()});c.request()},_onLoadListInfo:function(){this._oModel.evTotalCountChanged.notify();this._oModel.evListChanged.notify();this._oModel.evPagingChanged.notify()},_getAsyncListURL:function(a){var b="";if(this._oModel.isViewTab1()){b=BuddyConnect.METADATA.URL.BUDDYLISTBYME}else{b=BuddyConnect.METADATA.URL.BUDDYLISTTOME}return b+"?blogId="+this._oModel.getBlogId()+"&groupId="+null+"&currentPage="+a+"&authCode="+this._oModel.getAuthCode()+"&widgetSeq="+this._oModel.getWidgetSeq()},_getParam:function(a){if(a){var c=/_param\((.*)\)/;var b=a.match(c);if(b&&b[0]&&b[1]){return b[1].split("|")}}return null},openAddBuddy:function(){if(this._oModel.isMeOrNeighbor()){alert("자신의 블로그이거나 이미 추가한 이웃입니다.");return}window.open(this._oModel.getSectionDomain()+"/connect/PopConnectBuddyAddForm.nhn?blogId="+this._oModel.getBlogId()+"&widgetSeq="+this._oModel.getWidgetSeq(),"widget_popup","width=450,height=320")}});BriefWidgetModel=$Class({TAB_CLASS:["tab1on","tab2on"],TAB1:1,TAB2:2,_sLoginId:null,_sBlogId:null,_sAuthCode:null,_sWidgetSeq:null,_sBlogNo:null,_sBlogUserNo:null,_bMeOrNeighbor:null,_nBuddyCount:0,_nFollowerCount:0,_htBuddyListInfo:null,_nPageNo:1,_nTotalPageCount:1,_nViewTab:1,_bBlogOwner:false,_nTotalCountForPaging:0,_sSectionDomain:null,$init:function(){this.evTotalCountChanged=new jsMVC.Event();this.evTabChanged=new jsMVC.Event();this.evListChanged=new jsMVC.Event();this.evPagingChanged=new jsMVC.Event();this.evInit=new jsMVC.Event()},initMembers:function(a){this._sLoginId=a.sLoginId;this._sBlogId=a.sBlogId;this._sAuthCode=a.sAuthCode;this._sWidgetSeq=a.sWidgetSeq;this._sBlogNo=a.sBlogNo;this._sBlogUserNo=a.sBlogUserNo;this._bMeOrNeighbor=a.bMeOrNeighbor;this._nBuddyCount=a.nBuddyCount;this._nFollowerCount=a.nFollowerCount;this._nTotalPageCount=a.nTotalPageCount;this._nViewTab=a.nViewTab;this._bBlogOwner=a.bBlogOwner;this._nTotalCountForPaging=a.nTotalCountForPaging;this._sSectionDomain=a.sSectionDomain},getLoginId:function(){return this._sLoginId},getBlogId:function(){return this._sBlogId},getAuthCode:function(){return this._sAuthCode},getWidgetSeq:function(){return this._sWidgetSeq},getBlogNo:function(){return this._sBlogNo},getBlogUserNo:function(){return this._sBlogUserNo},isMeOrNeighbor:function(){return this._bMeOrNeighbor},getPageNo:function(){return this._nPageNo},setPageNo:function(a){this._nPageNo=a},setFirstPageNo:function(){this._nPageNo=1},getBuddyCount:function(){return this._nBuddyCount},setBuddyCount:function(a){this._nBuddyCount=a},isNoBuddy:function(){return this._nBuddyCount==0},getFollowerCount:function(){return this._nFollowerCount},setFollowerCount:function(a){this._nFollowerCount=a},isNoFollower:function(){return this._nFollowerCount==0},getBuddyListInfo:function(){return this._htBuddyListInfo},setBuddyListInfo:function(a){this._htBuddyListInfo=a},getTotalPageCount:function(){return this._nTotalPageCount},setTotalPageCount:function(a){this._nTotalPageCount=a},getViewTab:function(){return this._nViewTab},getViewTabClass:function(){return this.TAB_CLASS[this._nViewTab-1]},setViewTab:function(a){this._nViewTab=a},isViewTab1:function(){return this._nViewTab==this.TAB1},isViewTab2:function(){return this._nViewTab==this.TAB2},setViewTab1:function(){this._nViewTab=this.TAB1},setViewTab2:function(){this._nViewTab=this.TAB2},isBlogOwner:function(){return this._bBlogOwner},setTotalCountForPaging:function(a){this._nTotalCountForPaging=a},getTotalCountForPaging:function(){return this._nTotalCountForPaging},getSectionDomain:function(){return this._sSectionDomain}});BriefWidgetView=$Class({THUMBIMGPATH:"http://blogthumb2.naver.net",oTempate:null,$init:function(){this._oModel=jsMVC.getModel("briefWidgetController","briefWidgetModel");this.elWidget=$("briefWidget");this.elBuddyList=$("briefBuddyList");this.elTabArea=$("briefTab");this.elBuddyTotalCount=cssquery.getSingle("a > span > strong",$("buddyTotalCount"));this.elFollowerTotalCount=cssquery.getSingle("a > span > strong",$("followerTotalCount"));this.elPageInfo=$("pageInfo");this.welContent=$Element("content");this.welPaging=$Element("paging");this.welNoBuddy=$Element("noBuddy");this.welNoFollower=$Element("noFollower");this.welNoFollowerWhenBlogOwner=$Element("noFollowerWhenBlogOwner");this.welPrevBtn=$Element("prevBtn");this.welPrevOffBtn=$Element("prevOffBtn");this.welNextBtn=$Element("nextBtn");this.welNextOffBtn=$Element("nextOffBtn");this._oTemplate=$Template('<li><div><a href="{=linkUrl}" target="_blank" class="_clickcr  _param(wmy.list|{=RANK})" title="{=nickNameView}"><img src="'+gsThumbnailURL+'{=imgUrl}" width="35" height="35" alt="{=nickNameView}" onerror="this.onerror=null; this.src=\'https://blogimgs.pstatic.net/nblog/comment/login_basic.gif\'"><span></span>{if hasNewPost}<em class="up"><em>UP</em></em>{/if}</a>{if isDeletable}<a href="#" class="del _deleteBuddy _returnFalse"><span>삭제</span></a>{/if}</div></li>\n');this._oPageTemplate=$Template("<strong>{=pageNo}</strong><em>/</em>{=totalPageCount}");this._oBuddyTabTemplate=$Template("{if isKorean}내가 추가한{else}Following{/if}<br><strong>{=count}</strong>");this._oFollowerTabTemplate=$Template("{if isKorean}나를 추가한{else}Followers{/if}<br><strong>{=count}</strong>");this._setEvent()},_setEvent:function(){this._oModel.evInit.attach($Fn(this._onInit,this).bind());this._oModel.evTotalCountChanged.attach($Fn(this._onTotalCountChanged,this).bind());this._oModel.evTabChanged.attach($Fn(this._onTabChanged,this).bind());this._oModel.evListChanged.attach($Fn(this._onListChanged,this).bind());this._oModel.evPagingChanged.attach($Fn(this._onPagingChanged,this).bind());this._oModel.evInit.attach($Fn(this._onInit,this).bind())},_onInit:function(){this._showContent()},_onTotalCountChanged:function(){this.elFollowerTotalCount.innerHTML=this._oModel.getFollowerCount();this.elBuddyTotalCount.innerHTML=this._oModel.getBuddyCount()},_onTabChanged:function(){this.elTabArea.className="tab "+this._oModel.getViewTabClass()},_onListChanged:function(){var a=this._oModel.getBuddyListInfo();var c=[];var b=(a.currentPage-1)*a.countPerPage;$A(a.list).forEach($Fn(function(d,e,f){if(this._oModel.isViewTab2()&&this._oModel.getLoginId()==d.blogId){d.isDeletable=true}else{d.isDeletable=false}d.RANK=e+b+1;d.nickNameView=d.neighborNickName==""?d.blogName:d.neighborNickName;c.push(this._oTemplate.process(d))},this).bind());this.elBuddyList.innerHTML=c.join("");this._showContent()},_onPagingChanged:function(){var a=this._oModel.getPageNo();this._enablePrevBtn(a>1);this._enableNextBtn(a<this._oModel.getTotalPageCount());this._updatePageInfo()},_enableNextBtn:function(a){if(a){this.welNextOffBtn.css("display","none");this.welNextBtn.css("display","inline-block")}else{this.welNextOffBtn.css("display","inline-block");this.welNextBtn.css("display","none")}},_enablePrevBtn:function(a){if(a){this.welPrevOffBtn.css("display","none");this.welPrevBtn.css("display","inline-block")}else{this.welPrevOffBtn.css("display","inline-block");this.welPrevBtn.css("display","none")}},_updatePageInfo:function(){this.elPageInfo.innerHTML=this._oPageTemplate.process({pageNo:this._oModel.getPageNo(),totalPageCount:this._oModel.getTotalPageCount()})},_showContent:function(){if(this._oModel.isViewTab1()&&this._oModel.getTotalCountForPaging()==0){this._showNoBuddy();return}if(this._oModel.isViewTab2()&&this._oModel.getTotalCountForPaging()==0){if(this._oModel.isBlogOwner()){this._showNoFollowerWhenBlogOwner()}else{this._showNoFollower()}return}this.welContent.show();this.welPaging.show();this.welNoBuddy.hide();this.welNoFollower.hide();this.welNoFollowerWhenBlogOwner.hide()},_showNoBuddy:function(){this.welNoBuddy.show();this.welContent.hide();this.welPaging.hide();this.welNoFollower.hide();this.welNoFollowerWhenBlogOwner.hide()},_showNoFollowerWhenBlogOwner:function(){this.welNoBuddy.hide();this.welContent.hide();this.welPaging.hide();this.welNoFollower.hide();this.welNoFollowerWhenBlogOwner.show()},_showNoFollower:function(){this.welNoBuddy.hide();this.welContent.hide();this.welPaging.hide();this.welNoFollower.show();this.welNoFollowerWhenBlogOwner.hide()}});jsMVC.setController("briefWidgetController",BriefWidgetController);jsMVC.setModel("briefWidgetController","briefWidgetModel",BriefWidgetModel);jsMVC.setModel("briefWidgetController","briefWidgetView",BriefWidgetView);var oController=jsMVC.getController("briefWidgetController");oController.start(oOp);if(typeof(window.defineNHNJS)=="undefined"){window.defineNHNJS={}}window.defineNHNJS["BuddyConnectBriefWidget-821638990_js"]=true;
